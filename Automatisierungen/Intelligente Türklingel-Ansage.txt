automation:
  - id: 'smart_doorbell_announcement'
    alias: "Intelligente Türklingel Ansage"
    trigger:
      - platform: state
        entity_id: binary_sensor.doorbell
        to: "on"
    action:
      - service: conversation.process
        data:
          agent_id: conversation.freellm_chat
          text: >
            Jemand hat geklingelt. Erstelle eine kurze, höfliche Ansage.
            Aktuelle Uhrzeit: {{ now().strftime('%H:%M') }}.
            Wochentag: {{ now().strftime('%A') }}.
            Wenn es nach 20 Uhr ist, erwähne dass es spät ist.
        response_variable: doorbell_response
      - service: tts.speak
        target:
          entity_id: tts.piper
        data:
          media_player_entity_id: media_player.alle_lautsprecher
          message: "{{ doorbell_response.response.speech.plain.speech }}"